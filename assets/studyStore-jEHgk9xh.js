import{D as d}from"./main-BzxyhOKS.js";const s=typeof window<"u";class g extends d{notes;bookmarks;videoProgress;favorites;watchLater;sessions;streak;settings;constructor(){super("StudyDatabase"),this.version(1).stores({notes:"id, videoId, createdAt, importance, *tags",bookmarks:"id, videoId, createdAt",videoProgress:"videoId, completed, lastWatched, watchedPercentage",favorites:"videoId, addedAt",watchLater:"videoId, addedAt, priority",sessions:"id, videoId, startTime, endTime",streak:"id",settings:"id"})}}let c=null;function n(){if(!s)throw new Error("Database can only be accessed in the browser");return c||(c=new g),c}function l(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function f(){return new Date().toISOString().split("T")[0]}function u(){return{id:"main",pomodoroLength:25,breakLength:5,autoResumeEnabled:!0,keyboardShortcutsEnabled:!0,defaultPlaybackSpeed:1,totalWatchTime:0}}function y(){return{id:"main",currentStreak:0,longestStreak:0,lastStudyDate:"",studyDates:[]}}function i(t){return{videoId:t,completed:!1,lastWatched:new Date().toISOString(),watchedPercentage:0,rating:0}}async function k(t){if(!s)return{notes:[],bookmarks:[],progress:i(t)};try{const e=n(),[a,r,o]=await Promise.all([e.notes.where("videoId").equals(t).toArray(),e.bookmarks.where("videoId").equals(t).toArray(),e.videoProgress.get(t)]);return{notes:a||[],bookmarks:r||[],progress:o||i(t)}}catch(e){return console.error("Error loading video study data:",e),{notes:[],bookmarks:[],progress:i(t)}}}async function S(t,e){if(s)try{const a=n();await a.transaction("rw",[a.notes,a.bookmarks,a.videoProgress],async()=>{if(await a.notes.where("videoId").equals(t).delete(),await a.bookmarks.where("videoId").equals(t).delete(),e.notes.length>0){const r=e.notes.map(o=>({...o,videoId:t}));await a.notes.bulkPut(r)}if(e.bookmarks.length>0){const r=e.bookmarks.map(o=>({...o,videoId:t}));await a.bookmarks.bulkPut(r)}await a.videoProgress.put({...e.progress,videoId:t})})}catch(a){console.error("Error saving video study data:",a)}}async function b(t){if(!s)return 0;try{return(await n().videoProgress.get(t))?.lastPosition||0}catch{return 0}}async function p(t,e){if(s)try{const a=n(),r=await a.videoProgress.get(t);await a.videoProgress.put({...r||i(t),videoId:t,lastPosition:e,lastWatched:new Date().toISOString()})}catch(a){console.error("Error saving video position:",a)}}async function D(t){if(s)try{const e=n();await e.favorites.get(t.id)||await e.favorites.put({videoId:t.id,title:t.title,thumbnail:t.thumbnail,addedAt:new Date().toISOString()})}catch(e){console.error("Error adding to favorites:",e)}}async function v(t){if(s)try{await n().favorites.delete(t)}catch(e){console.error("Error removing from favorites:",e)}}async function A(t){if(!s)return!1;try{return!!await n().favorites.get(t)}catch{return!1}}async function P(t,e="medium"){if(s)try{const a=n();await a.watchLater.get(t.id)||await a.watchLater.put({videoId:t.id,title:t.title,thumbnail:t.thumbnail,addedAt:new Date().toISOString(),priority:e})}catch(a){console.error("Error adding to watch later:",a)}}async function E(t){if(s)try{await n().watchLater.delete(t)}catch(e){console.error("Error removing from watch later:",e)}}async function I(t){if(!s)return!1;try{return!!await n().watchLater.get(t)}catch{return!1}}async function w(){if(s)try{const t=n(),e=f(),a=new Date(Date.now()-864e5).toISOString().split("T")[0];let r=await t.streak.get("main");if(r||(r=y()),r.lastStudyDate===e)return;r.studyDates.includes(e)||r.studyDates.push(e),r.lastStudyDate===a?r.currentStreak++:r.lastStudyDate!==e&&(r.currentStreak=1),r.currentStreak>r.longestStreak&&(r.longestStreak=r.currentStreak),r.lastStudyDate=e,await t.streak.put(r)}catch(t){console.error("Error updating streak:",t)}}async function L(t,e,a=!1){if(!s)return"";try{const r=l();return await n().sessions.put({id:r,videoId:t,videoTitle:e,startTime:new Date().toISOString(),duration:0,notes:"",focusMode:a}),await w(),r}catch(r){return console.error("Error starting session:",r),""}}function x(){return u()}async function h(t){if(s)try{const e=n(),a=await e.settings.get("main")||u();await e.settings.put({...a,...t,id:"main"})}catch(e){console.error("Error updating settings:",e)}}function T(t){h(t)}export{I as a,p as b,L as c,D as d,E as e,P as f,b as g,x as h,A as i,T as j,k as l,v as r,S as s,w as u};
